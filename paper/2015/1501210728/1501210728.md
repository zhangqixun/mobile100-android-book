# Android APK DEX文件方法名混淆（1501210728吴辉）

##**1、简介**##
####1.1 背景  
&ensp;&ensp;&ensp;&ensp;随着信息技术的不断发展，尤其是近来各种智能终端的快速增长，对各种应用软件的可移植性或跨平台性能的要求越来越高。由此，例如java语言、perl语言、php语言等不将程序代码编译为二进制码可执行程序的编程语言的应用越来越广泛。  
&ensp;&ensp;&ensp;&ensp;这种不将程序代码编译为二进制码可执行程序的编程语言具有解释执行、跨平台等特性，尤其是其跨平台性，使开发人员摆脱了机器的束缚，可实现“一次编译，到处运行”。然而，正是由于利用这种编程语言编写的程序在运行时直接以程序语言代码或中间代码表示，这就导致采用非编译型编程语言编写的程序源代码容易被窃取。  
&ensp;&ensp;&ensp;&ensp;Android平台所使用的主流编程语言Java程序在运行前虽然需要经过编译，但并不会直接被编译成（二进制的）机器语言，而是编译成java字节码后，再通过Java虚拟机解释执行。更具体地，Java字节码文件是将采用Java语言编写的程序代码进行编译后产生的中间文件。它往往与Java虚拟机一起出现，是实现平台无关性的要素之一。因而，如何防止采用Java语言编写的程序被窃取的问题，则转化为如何更好地对Java字节码文件进行保护（加密）的问题。当前，Java编程语言工具并未对Java字节码采取有效保护措施。加之，Java字节码文件的结构本身的特点使其易于被反编译，源码易被窃取，故存在Java源码的安全问题。
####1.2 本文研究
&ensp;&ensp;&ensp;&ensp;针对Java字节码的特点，出现了以下几种方法来保护Java字节码：1.字节混淆技术；2.数字水印技术等。但是，这些方法都不能很好的保护Java字节码。字节码混淆并不能完全防止反编译，只是增加了反编译后代码阅读的难度；而数字水印只能保证版权，并不能保证代码遭反编译后被其它开发者利用。然而，Android系统又采用了不同于传统虚拟机的Dalvik虚拟机。Dalvik基于寄存器实现，缩减了Java虚拟机的指令集。在Dalvik平台，Java应用程序被编译生成DEX文件，并载入运行。我们可以使用工具直接从dex机器码反编译回java源代码。任何人都可以通过这种方式获得并修改源码，插入恶意程序，因此，对于android应用本身是不安全的。  
&ensp;&ensp;&ensp;&ensp;本文采用MD5摘要算法，对DEX文件中的方法名进行加密，从而生成新的DEX文件，用它替换原DEX文件与安卓程序一起打包发布。由于该方法通过只针对APK文件中的DEX文件的关键信息(部分方法名)的加密保护，从而提高了加密和解密的执行效率。

##**2、基础知识**##
* **知识点1---Dex文件**

&ensp;&ensp;&ensp;&ensp;classes.dex文件是Android系统运行于Dalvik Virtua lMachine上的可执行文件，也是Android应用程序的核心所在，所以我们首先来看下DEX文件的结构，这样能够更好的理解后续的分析。从Java源文件（当然Android也支持JNI的调用方式）到生成Dex文件的基本映射关系如下图所示：



* **知识点2**



* **知识点3**



##**3、主要思路及步骤**##
**3.1 主要思路**

* 解析步骤，从待加密的Android应用软件的APK文件中解析出DEX文件；
* 加密步骤，对该DEX文件的全部或部分信息进行加密，生成加密后的DEX文件；
* 生成步骤，将该加密后的DEX文件替换加密前的所述DEX文件，生成对该DEX文件的全部或部分信息进行了加密的APK文件和对密钥进行MD5加密的摘要文件。

**3.2 实践步骤**


**3.3 实现效果**



##**4、参考资料**##
[1]  刘建培，卞佳丽，张晓杰．一种适用于Android系统的软件保护方法及系统:中国，CN201110180829[p].2015-12-13  
[2]代码混淆—android被反编译的两种解决方案  
http://blog.csdn.net/online1989/article/details/7058743  
[3]Android proguard代码混淆  
http://www.cnblogs.com/wangcan/p/3477840.html  
[4] Android Dex文件结构  
http://blog.csdn.net/pang3510726681/article/details/11610365  
[5]android逆向学习小结--CrackMe_1  
http://www.cnblogs.com/LittleHann/p/3374206.html  
[6]APK 的自我保护  
http://bbs.pediy.com/showthread.php?t=183116    
